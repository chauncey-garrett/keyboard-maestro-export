<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <array>
    <dict>
      <key>UID</key>
      <string>AF01D28D-2745-40E0-B027-766AEBC17615</string>
      <key>IsBrowserContainerOpen</key>
      <true/>
      <key>Targeting</key>
      <dict>
        <key>Targeting</key>
        <string>Included</string>
        <key>TargetingApps</key>
        <array>
          <dict>
            <key>NewFile</key>
            <string>/Applications/VLC.app</string>
            <key>BundleIdentifier</key>
            <string>org.videolan.vlc</string>
            <key>Name</key>
            <string>VLC.app</string>
            <key>Alias</key>
            <data>AAAAAAFAAAIAAQxNYWNpbnRvc2ggSEQAAAAAAAAAAAAAAAAAAADFk0UISCsAAAJQKN8HVkxDLmFwcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAg/J5cnJ6L4AAAAAAAAAAP////8AAAkgAAAAAAAAAAAAAAAAAAAADEFwcGxpY2F0aW9ucwAQAAgAAMWTi1gAAAARAAgAAMnKIP4AAAABAAQCUCjfAAIAIk1hY2ludG9zaCBIRDpBcHBsaWNhdGlvbnM6AFZMQy5hcHAADgAQAAcAVgBMAEMALgBhAHAAcAAPABoADABNAGEAYwBpAG4AdABvAHMAaAAgAEgARAASABRBcHBsaWNhdGlvbnMvVkxDLmFwcAATAAEvAP//AAA=</data>
            <key>FileType</key>
            <integer>1095782476</integer>
            <key>Creator</key>
            <integer>1447838499</integer>
          </dict>
        </array>
      </dict>
      <key>Activate</key>
      <string>Normal</string>
      <key>AddToMacroPalette</key>
      <false/>
      <key>IsActive</key>
      <false/>
      <key>KeyCode</key>
      <integer>32767</integer>
      <key>Name</key>
      <string>VLC</string>
      <key>Modifiers</key>
      <integer>0</integer>
      <key>AddToStatusMenu</key>
      <false/>
      <key>Macros</key>
      <array>
        <dict>
          <key>UID</key>
          <string>4E3D77FE-50D5-4832-A418-FBF918DFE3D3</string>
          <key>Name</key>
          <string>TAG - Tag Currently Playing Video</string>
          <key>Triggers</key>
          <array>
            <dict>
              <key>MacroTriggerType</key>
              <string>HotKey</string>
              <key>Modifiers</key>
              <integer>0</integer>
              <key>FireType</key>
              <string>Pressed</string>
              <key>TriggerRepeat</key>
              <false/>
              <key>KeyCode</key>
              <integer>65</integer>
            </dict>
          </array>
          <key>IsActive</key>
          <true/>
          <key>Actions</key>
          <array>
            <dict>
              <key>TrimResults</key>
              <true/>
              <key>NewFile</key>
              <string></string>
              <key>IsDisclosed</key>
              <true/>
              <key>MacroActionType</key>
              <string>ExecuteShellScript</string>
              <key>TimeOutAbortsMacro</key>
              <true/>
              <key>File</key>
              <data></data>
              <key>IsActive</key>
              <true/>
              <key>Text</key>
              <string>#!/usr/bin/env php
						&lt;?php
						
						$currently_playing = `lsof -p $(/usr/local/bin/pidof VLC) | cut -c 77-1000 | grep -i -E '(mkv|avi|m4v|mp4|wmv|flv|mov|mpg|vob)$'`;
						
						$cmd = "openmeta -p " . escapeshellarg(str_replace(PHP_EOL, '', $currently_playing));
						
						$output = `$cmd`;
						
						$has_matches = preg_match('/^tags:\s(.*?)$/m', $output, $matches);
						
						if($has_matches) {
							$tags = trim($matches[1]);
						} else {
							$tags = "";
						}
						
						if(empty($tags)) {
							$tags = "none";
						}
						
						echo $tags;</string>
              <key>Variable</key>
              <string>existingTags</string>
              <key>UseText</key>
              <true/>
              <key>DisplayKind</key>
              <string>Variable</string>
            </dict>
            <dict>
              <key>Prompt</key>
              <string>Enter Tags</string>
              <key>ResultButtonVariable</key>
              <string>Result Button</string>
              <key>IsDisclosed</key>
              <true/>
              <key>MacroActionType</key>
              <string>PromptForUserInput</string>
              <key>TimeOutAbortsMacro</key>
              <true/>
              <key>IsActive</key>
              <true/>
              <key>Buttons</key>
              <array>
                <dict>
                  <key>Button</key>
                  <string>OK</string>
                </dict>
                <dict>
                  <key>Button</key>
                  <string>Cancel</string>
                  <key>Cancel</key>
                  <true/>
                </dict>
              </array>
              <key>Title</key>
              <string>Tags</string>
              <key>Variables</key>
              <array>
                <dict>
                  <key>Default</key>
                  <string>%Variable%existingTags%</string>
                  <key>Variable</key>
                  <string>newTags</string>
                </dict>
              </array>
            </dict>
            <dict>
              <key>TrimResults</key>
              <true/>
              <key>NewFile</key>
              <string></string>
              <key>IsDisclosed</key>
              <true/>
              <key>MacroActionType</key>
              <string>ExecuteShellScript</string>
              <key>TimeOutAbortsMacro</key>
              <true/>
              <key>File</key>
              <data></data>
              <key>IsActive</key>
              <true/>
              <key>Text</key>
              <string>#!/usr/bin/env php
						&lt;?php
						
						function getVlcCurrentlyPlaying() {
							$currently_playing = `lsof -p $(/usr/local/bin/pidof VLC) | cut -c 77-1000 | grep -i -E '(mkv|avi|m4v|mp4|wmv|flv|mov|mpg|vob)$'`;
							return $currently_playing;
						}
						
						
						$currently_playing = getVlcCurrentlyPlaying();
						$filename = pathinfo($currently_playing, PATHINFO_FILENAME);
						$tags_str = $_ENV['KMVAR_newTags'];
						
						$tags = preg_split('/[\s]*?,[\s]*?/', $tags_str);
						
						array_walk($tags, function(&amp;$val) { $val = trim($val); });
						
						$tags_str =  join($tags, " ");
						
						$cmd = "openmeta -s " . $tags_str . " -p " . escapeshellarg(str_replace(PHP_EOL, '', $currently_playing));
						
						$output = `$cmd`;
						
						$growlcmd = '/usr/local/bin/growlnotify --appIcon VLC -t ' . escapeshellarg("Set Tags on " . $filename) . ' -m ' . escapeshellarg($tags_str);
						`$growlcmd`;</string>
              <key>Variable</key>
              <string>Variable</string>
              <key>UseText</key>
              <true/>
              <key>DisplayKind</key>
              <string>None</string>
            </dict>
          </array>
        </dict>
      </array>
    </dict>
  </array>
</plist>
